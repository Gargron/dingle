<ul class="breadcrumb">
  <li><%= link_to t('countries.title'), root_path %> <span class="divider">/</span></li>
  <li><%= link_to @provider.country.name, country_path(@provider.country) %> <span class="divider">/</span></li>
  <li class="active"><%= @provider.name %></li>
</ul>

<h3 style="margin-bottom: 18px"><%= t('providers.name') %>: <%= @provider.name %></h3>

<table class="table table-bordered">
  <thead>
    <tr>
      <th><%= t('providers.overall') %></th>
      <th><%= t('providers.privacy') %></th>
      <th><%= t('providers.stability') %></th>
      <th><%= t('providers.price_value') %></th>
      <th><%= t('providers.support') %></th>
    </tr>
  </thead>
  
  <tbody>
    <tr>
      <td><%= "%.1f" % (@provider.overall || 0) %></td>
      <td><%= "%.1f" % (@provider.privacy || 0) %></td>
      <td><%= "%.1f" % (@provider.stability || 0) %></td>
      <td><%= "%.1f" % (@provider.price_value || 0) %></td>
      <td><%= "%.1f" % (@provider.support || 0) %></td>
    </tr>
  </tbody>
</table>

<hr />

<% if @provider.ratings.count > 1 %>
  <div class="row">
    <div class="span6">
      <h4 style="margin-bottom: 18px"><%= t('ratings.best') %></h4>

      <div class="speech-bubble">
        <%= markdown(@provider.ratings.best.first.review.content) %>
      </div>

      <p><%= t('ratings.by', name: @provider.ratings.best.first.user.name) %> &bull; <%= @provider.ratings.best.first.created_at %></p>
    </div>

    <div class="span6">
      <h4 style="margin-bottom: 18px"><%= t('ratings.worst') %></h4>

      <div class="speech-bubble">
        <%= markdown(@provider.ratings.worst.first.review.content) %>
      </div>

      <p><%= t('ratings.by', name: @provider.ratings.worst.first.user.name) %> &bull; <%= @provider.ratings.worst.first.created_at %></p>
    </div>
  </div>

  <hr />
<% end %>

<ul class="unstyled">
  <% @provider.ratings.includes(:review, :user).each do |rating| %>
    <li>
      <div class="row">
        <div class="span4">
          <table class="table table-bordered table-striped">
            <col width="40%" />

            <tbody>
              <tr>
                <th><%= t('providers.privacy') %></th>
                <td><% 1.upto(rating.privacy) do |x| %><i class="icon-star"></i><% end %></td>
              </td>

              <tr>
                <th><%= t('providers.stability') %></th>
                <td><% 1.upto(rating.stability) do |x| %><i class="icon-star"></i><% end %></td>
              </td>

              <tr>
                <th><%= t('providers.price_value') %></th>
                <td><% 1.upto(rating.price_value) do |x| %><i class="icon-star"></i><% end %></td>
              </td>

              <tr>
                <th><%= t('providers.support') %></th>
                <td><% 1.upto(rating.support) do |x| %><i class="icon-star"></i><% end %></td>
              </td>
            </tbody>
          </table>
        </div>

        <div class="span8">
          <div class="speech-bubble">
            <%= markdown(rating.review.content) %>
          </div>

          <p>
            <%= raw t('ratings.by', name: rating.user.name) %>
            &bull; <%= rating.created_at %>
            &bull; <%= rating.kudos.count %> people agree
            <% if not (not current_user.new_record? && rating.kudos.where_user_id(current_user.id).count > 0) %>
              &bull; <%= link_to t('ratings.kudos'), kudos_path(Kudo.new, :rating_id => rating.id), :method => :post %>
            <% else %>
              &bull; You appreciate this
            <% end %>
          </p>
        </div>
      </div>
    </li>
  <% end %>
</ul>

<hr />

<%= form_for @rating do |f| %>
  <legend><%= t('ratings.submit_yours') %></legend>

  <%= f.hidden_field :provider_id %>
  
  <% @rating.errors.each do |attr, err| %>
    <div class="alert alert-error">
      <strong><%= attr %></strong> <%= err %>
    </div>
  <% end %>

  <div class="row">
    <div class="span4">
      <div class="control-group">
        <%= f.label :privacy, t('ratings.form.privacy'), :class => 'control-label' %>

        <div class="controls">
          <%= f.text_field :privacy, :class => 'span4' %>
        </div>
      </div>
      
      <div class="control-group">
        <%= f.label :stability, t('ratings.form.stability'), :class => 'control-label' %>

        <div class="controls">
          <%= f.text_field :stability, :class => 'span4' %>
        </div>
      </div>

      <div class="control-group">
        <%= f.label :support, t('ratings.form.support'), :class => 'control-label' %>

        <div class="controls">
          <%= f.text_field :support, :class => 'span4' %>
        </div>
      </div>

      <div class="control-group">
        <%= f.label :price_value, t('ratings.form.price_value'), :class => 'control-label' %>

        <div class="controls">
          <%= f.text_field :price_value, :class => 'span4' %>
        </div>
      </div>
    </div>

    <div class="span8">
      <%= f.fields_for :review do |b| %>
        <div class="control-group">
          <%= b.label :content, t('ratings.review'), :class => 'control-label' %>

          <div class="controls">
            <%= b.text_area :content, :rows => 4, :class => 'span8' %>
          </div>
        </div>
      <% end %>

      <%= f.fields_for :user do |u| %>
        <div class="control-group">
          <%= u.label :name, t('users.name'), :class => 'control-label' %>

          <div class="controls">
            <%= u.text_field :name, :class => 'span4', :value => current_user.name %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="form-actions">
    <%= f.button t('ratings.form.submit'), :class => 'btn btn-primary' %>
  </div>
<% end %>